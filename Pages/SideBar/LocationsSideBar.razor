@inject IDialogService DialogService
@inject WarehouseHotelService _warehouseHotelService
@inject LocationService _locationService

<style>
    .lagerhotell-link-change {
        margin-right: -30px;
    }



    .lagerhotell-link-text {
        display: inline-block;
        width: 90px;
    }

    .lagerhotell-link {
        display: flex;
        align-items: stretch;
    }
</style>

<MudDrawerHeader>
    <MudText Typo="Typo.h6">Lokasjoner</MudText>
</MudDrawerHeader>
<MudNavMenu>
    <MudNavGroup Title="Geilo">
        <AuthorizeView Roles="Administrator">
            <Authorized>
                <MudNavLink ActiveClass="test" Icon="@Icons.Material.Filled.LocationCity" Class="lagerhotell-link" Href="/Lagerhotell/Geilovegen"><div class="lagerhotell-link-text">Geilovegen</div></MudNavLink>
                <MudNavLink Icon="@Icons.Material.Filled.LocationCity" Class="lagerhotell-link" Href="/Lagerhotell/Geilovegen"><div class="lagerhotell-link-text">Lienvegen</div></MudNavLink>
            </Authorized>
            <NotAuthorized>
                <MudNavLink Icon="@Icons.Material.Filled.LocationCity" Class="lagerhotell-link" Href="/Lagerhotell/Geilovegen"><div class="lagerhotell-link-text">Geilovegen</div></MudNavLink>
                <MudNavLink Icon="@Icons.Material.Filled.LocationCity" Class="lagerhotell-link" Href="/Lagerhotell/Geilovegen"><div class="lagerhotell-link-text">Lienvegen</div></MudNavLink>
            </NotAuthorized>
        </AuthorizeView>
        <AuthorizeView Roles="Administrator">
            <Authorized>
                <MudNavLink @onclick="OpenAddWarehouseHotelDialog" Class="add-or-delete-link" Icon="@Icons.Material.Filled.Add">Legg til ett lagerhotell</MudNavLink>
                <MudNavLink Class="add-or-delete-link" Icon="@Icons.Material.Filled.Delete">Slett ett lagerhotell</MudNavLink>
            </Authorized>
        </AuthorizeView>
    </MudNavGroup>
    <MudNavGroup Title="Kristiansund">
        <MudNavLink @onclick="OpenAddWarehouseHotelDialog" Icon="@Icons.Material.Filled.LocationCity" Href="/Lagerhotell/Bremsnes">Bremsnes</MudNavLink>
        <MudNavLink Icon="@Icons.Material.Filled.LocationCity" Href="/Lagerhotell/Rensvik">Rensvik</MudNavLink>
        <AuthorizeView Roles="Administrator">
            <Authorized>
                <MudNavLink @onclick="OpenAddWarehouseHotelDialog" Icon="@Icons.Material.Filled.Add">Legg til ett lagerhotell</MudNavLink>
                <MudNavLink Icon="@Icons.Material.Filled.Add">Slett ett lagerhotell</MudNavLink>
            </Authorized>
        </AuthorizeView>
    </MudNavGroup>
    <MudNavGroup Title="Moss">
        <MudNavLink Icon="@Icons.Material.Filled.LocationCity" Href="/Lagerhotell/Dilling">Dilling</MudNavLink>
        <MudNavLink Icon="@Icons.Material.Filled.LocationCity" Href="/Lagerhotell/Jeloy">Jeløy</MudNavLink>
        <AuthorizeView Roles="Administrator">
            <Authorized>
                <MudNavLink @onclick="OpenAddWarehouseHotelDialog" Icon="@Icons.Material.Filled.Add">Legg til ett lagerhotell</MudNavLink>
                <MudNavLink Icon="@Icons.Material.Filled.Delete" OnClick="OpenDeleteWarehouseHotelDialog">Slett ett lagerhotell</MudNavLink>
                <MudNavLink Icon="@Icons.Material.Filled.ChangeCircle" OnClick="OpenChangeWarehouseHotelDialog">Endre på ett lagerhotell</MudNavLink>
            </Authorized>
        </AuthorizeView>
    </MudNavGroup>
    <AuthorizeView Roles="Administrator">
        <Authorized>
            <MudNavLink @onclick="OpenAddLocationDialog" Icon="@Icons.Material.Filled.Add">Legg til en lokasjon</MudNavLink>
            <MudNavLink @onclick="OpenDeleteLocationDialog" Icon="@Icons.Material.Filled.Delete">Slett en lokasjon og tilhørende info</MudNavLink>
            <MudNavLink @onclick="OpenChangeLocationDialog" Icon="@Icons.Material.Filled.ChangeCircle">Endre en lokasjon</MudNavLink>
        </Authorized>
    </AuthorizeView>
</MudNavMenu>

<MudNavMenu>
    @if (isInitialized)
    {
        @foreach (var location in locations)
        {
            <MudNavGroup Title="@location.Name">
                @foreach (var warehouseHotel in warehouseHotels)
                {
                    if (warehouseHotel.LocationName == location.Name)
                    {
                        string url = "/Lagerhotell/" + warehouseHotel.Name;
                        <MudNavLink Icon="@Icons.Material.Filled.LocationCity" Class="lagerhotell-link" Href=@url><div class="lagerhotell-link-text">@warehouseHotel.Name </div></MudNavLink>
                    }
                }
            </MudNavGroup>
        }
    }
</MudNavMenu>

<style>
    .custom-class {
        backdrop-filter: blur(10px);
    }

    .width {
        max-width: 400px;
    }
</style>
@code {
    private List<Location> locations;
    private List<WarehouseHotel> warehouseHotels;
    private bool isInitialized = false;

    protected override async Task OnInitializedAsync()
    {
        await GetAllLocations();
        await GetAllWarehouseHotels();
        isInitialized = true;
    }


    private async Task GetAllLocations()
    {
        locations = await _locationService.GetAllLocations();
    }

    private async Task GetAllWarehouseHotels()
    {
        warehouseHotels = await _warehouseHotelService.GetAllWarehouseHotels();
    }

    private void OpenAddLocationDialog()
    {
        var options = new DialogOptions { ClassBackground = "custom-class" };
        DialogService.Show<Pages.Locations.Add>("Legg til en lokasjon", options);
    }

    private void OpenDeleteLocationDialog()
    {
        var options = new DialogOptions { ClassBackground = "custom-class" };
        DialogService.Show<Pages.Locations.Delete>("Slett en lokasjon", options);
    }

    private void OpenChangeLocationDialog()
    {
        var options = new DialogOptions { ClassBackground = "custom-class" };
        DialogService.Show<Pages.Locations.Change>("Endre en lokasjon", options);
    }

    private void OpenAddWarehouseHotelDialog()
    {
        var options = new DialogOptions { ClassBackground = "custom-class" };
        DialogService.Show<Pages.WarehouseHotels.AddWarehouseHotel>("Legg til ett lagerhotell", options);
    }

    private void OpenDeleteWarehouseHotelDialog()
    {
        var options = new DialogOptions { ClassBackground = "custom-class" };
        DialogService.Show<Pages.WarehouseHotels.DeleteWarehouseHotel>("Slett ett lagerhotell", options);
    }

    private void OpenChangeWarehouseHotelDialog()
    {
        var options = new DialogOptions { ClassBackground = "custom-class" };
        DialogService.Show<Pages.WarehouseHotels.ChangeWarehouseHotel>("Endre ett lagerhotell", options);
    }
}
