@page "/authentication/login-callback/"
@inject SessionService _sessionService

<h1>Test</h1>

@code {
    private string code { get; set; }
    private string state { get; set; }

    protected override async Task OnInitializedAsync()
    {
        var uri = NavigationManager.ToAbsoluteUri(NavigationManager.Uri);
        var queryParams = System.Web.HttpUtility.ParseQueryString(uri.Query);
        code = queryParams["code"];
        state = queryParams["state"];
        if (code == null || state == null)
        {
            Snackbar.Add("Noe gikk galt");
            await _sessionService.RemoveItemAsync("loginState");
            NavigationManager.NavigateTo("/");
            return;
        }
        string localStorageState = await _sessionService.GetLoginStateFromLocalStorage();
        if (localStorageState != state)
        {
            Snackbar.Add("Noe gikk galt");
            await _sessionService.RemoveItemAsync("loginState");
            NavigationManager.NavigateTo("/");
            return;
        }

    }
}
