@using System.Text
@using System.Text.Json
@using LagerhotellAPI.Models
@using Lagerhotell.Services.UserService

@page "/user/{userId}"

<MudGrid>
    <MudItem xs="12" md="3">
        <MudPaper Elevation="1">
            <MudList>
                <MudListItem>
                    <MudIcon Icon="@Icons.Material.Filled.AccountCircle" style="vertical-align: middle;" />
                    <span style="vertical-align: middle; margin-left: 8px;">Profil</span>
                </MudListItem>
                <MudListItem>
                    <MudIcon Icon="@Icons.Material.Filled.Security" style="vertical-align: middle;" />
                    <span style="vertical-align: middle; margin-left: 8px;">Sikkerhet</span>
                </MudListItem>
            </MudList>
        </MudPaper>
    </MudItem>
    <MudItem xs="12" md="9">
        <MudPaper Elevation="1" Class="pa-4">
            <MudText Typo="Typo.h6">Profil</MudText>
            <MudText Typo="Typo.subtitle1">Velkommen, @_userValues.FirstName!</MudText>
            <MudDivider Class="my-4" />
            <div class="d-flex align-items-center">
                <MudAvatar Src="path_to_image.jpg" />
                <div class="ml-2">
                        <MudText Typo="Typo.subtitle1"><MudText Style=" font-weight:780; display:inline">@_userValues.FirstName</MudText> @_userValues.LastName</MudText>
                </div>
            </div>
            <div Style="height: 8px"></div>
                <MudExpansionPanels MultiExpansion="true">
                    <MudExpansionPanel Text="Generelt">
                        <MudText Typo="Typo.subtitle2">Mobilnummer</MudText>
                        <MudText>@_userValues.PhoneNumber</MudText>
                        <MudDivider Class="my-4" />
                        <MudText Typo="Typo.subtitle2">Fødselsdato</MudText>
                        <MudText>@_userValues.BirthDate</MudText>
                        <MudDivider Class="my-4" />
                        <MudText Typo="Typo.subtitle2">Passord</MudText>
                        <MudText>**********</MudText>
                        <MudButton Variant="Variant.Filled" Style="height: 24px" Color="Color.Primary">Vis passord</MudButton>
                    </MudExpansionPanel>
                    <MudExpansionPanel Text="Bosted, Addresser">
                        <MudText Typo="Typo.subtitle2">Addresse</MudText>
                        <MudText>@_userValues.Address</MudText>
                        <MudDivider Class="my-4" />
                        <MudText Typo="Typo.subtitle2">Postnummer</MudText>
                        <MudText>@_userValues.PostalCode</MudText>
                        <MudDivider Class="my-4" />
                        <MudText Typo="Typo.subtitle2">By, Poststed</MudText>
                        <MudText>@_userValues.City</MudText>
                    </MudExpansionPanel>
                </MudExpansionPanels>
        </MudPaper>
    </MudItem>
</MudGrid>




@inject HttpClient Http
@inject SessionService sessionService
@inject ISnackbar snackBar
    @code {
    private static readonly HttpClient client = new HttpClient();
    [Parameter] public string UserId { get; set; }
    private User _userValues = new User();
    private UserServiceUserSettings _userServiceUserSettings = new();

    protected override async Task OnInitializedAsync()
    {
        try
        {
            string token = await sessionService.GetJwtFromLocalStorage();
            var user = await _userServiceUserSettings.LoadUser(client, _userValues, UserId, token);
            // Console.WriteLine(user.LastName);
            if (user != null)
            {
                _userValues.FirstName = user.FirstName;
                _userValues.LastName = user.LastName;
                _userValues.PhoneNumber = user.PhoneNumber;
                _userValues.BirthDate = user.BirthDate;
                _userValues.Password = user.Password;
                snackBar.Add("Vellykket innlogging!", Severity.Success);
            }
            else
            {
                snackBar.Add("Kunne ikke laste inn brukeren", Severity.Error);
            }
        } catch (Exception ex)
        {
            snackBar.Add("Kunne ikke laste inn brukeren", Severity.Error);
        }
        StateHasChanged();
    }
}
